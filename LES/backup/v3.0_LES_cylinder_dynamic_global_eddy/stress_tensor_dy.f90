	SUBROUTINE STRESS_TENSOR_DY
	
	USE COMDAT_SHARED
	
	IMPLICIT NONE
	SAVE

	INCLUDE 'mpif.h'
	
	DOUBLE PRECISION :: B11,B12,B13
	DOUBLE PRECISION :: B22,B23		!B21,B22,B23
	DOUBLE PRECISION :: B33			!B31,B32,B33
	
	DOUBLE PRECISION :: BBT
	
	DOUBLE PRECISION :: CV_AVG
	DOUBLE PRECISION :: INC
	
	DO K=KS1,KE1
	DO J=JS1,JE1
	DO I=IS1,IE1
	DUDX=0.5D0*(XIX(I,J,K)*(U(I+1,J,K)-U(I-1,J,K))+ETX(I,J,K)*(U(I,J+1,K)-U(I,J-1,K))+ZTX(I,J,K)*(U(I,J,K+1)-U(I,J,K-1)))
	DVDX=0.5D0*(XIX(I,J,K)*(V(I+1,J,K)-V(I-1,J,K))+ETX(I,J,K)*(V(I,J+1,K)-V(I,J-1,K))+ZTX(I,J,K)*(V(I,J,K+1)-V(I,J,K-1)))
	DWDX=0.5D0*(XIX(I,J,K)*(W(I+1,J,K)-W(I-1,J,K))+ETX(I,J,K)*(W(I,J+1,K)-W(I,J-1,K))+ZTX(I,J,K)*(W(I,J,K+1)-W(I,J,K-1)))
	
	DUDY=0.5D0*(XIY(I,J,K)*(U(I+1,J,K)-U(I-1,J,K))+ETY(I,J,K)*(U(I,J+1,K)-U(I,J-1,K))+ZTY(I,J,K)*(U(I,J,K+1)-U(I,J,K-1)))
	DVDY=0.5D0*(XIY(I,J,K)*(V(I+1,J,K)-V(I-1,J,K))+ETY(I,J,K)*(V(I,J+1,K)-V(I,J-1,K))+ZTY(I,J,K)*(V(I,J,K+1)-V(I,J,K-1)))
	DWDY=0.5D0*(XIY(I,J,K)*(W(I+1,J,K)-W(I-1,J,K))+ETY(I,J,K)*(W(I,J+1,K)-W(I,J-1,K))+ZTY(I,J,K)*(W(I,J,K+1)-W(I,J,K-1)))
	
	DUDZ=0.5D0*(XIZ(I,J,K)*(U(I+1,J,K)-U(I-1,J,K))+ETZ(I,J,K)*(U(I,J+1,K)-U(I,J-1,K))+ZTZ(I,J,K)*(U(I,J,K+1)-U(I,J,K-1)))
	DVDZ=0.5D0*(XIZ(I,J,K)*(V(I+1,J,K)-V(I-1,J,K))+ETZ(I,J,K)*(V(I,J+1,K)-V(I,J-1,K))+ZTZ(I,J,K)*(V(I,J,K+1)-V(I,J,K-1)))
	DWDZ=0.5D0*(XIZ(I,J,K)*(W(I+1,J,K)-W(I-1,J,K))+ETZ(I,J,K)*(W(I,J+1,K)-W(I,J-1,K))+ZTZ(I,J,K)*(W(I,J,K+1)-W(I,J,K-1)))
	
	!	THE LARGE-SCALE STRAIN-RATE TENSOR ,S_ij (STRAIN-RATE TENSOR FOR THE RESOLVED SCALE)
	S11(I,J,K)=0.5D0*DUDX + 0.5D0*DUDX
	S12(I,J,K)=0.5D0*DUDY + 0.5D0*DVDX
	S13(I,J,K)=0.5D0*DUDZ + 0.5D0*DWDX
	
!	S21(I,J,K)=0.5D0*DVDX + 0.5D0*DUDY
	S22(I,J,K)=0.5D0*DVDY + 0.5D0*DVDY
	S23(I,J,K)=0.5D0*DVDZ + 0.5D0*DWDY
	
!	S31(I,J,K)=0.5D0*DWDX + 0.5D0*DUDZ
!	S32(I,J,K)=0.5D0*DWDY + 0.5D0*DVDZ
	S33(I,J,K)=0.5D0*DWDZ + 0.5D0*DWDZ
	
	A11(I,J,K)=DUDX
	A12(I,J,K)=DVDX
	A13(I,J,K)=DWDX
	
	A21(I,J,K)=DUDY
	A22(I,J,K)=DVDY
	A23(I,J,K)=DWDY
	
	A31(I,J,K)=DUDZ
	A32(I,J,K)=DVDZ
	A33(I,J,K)=DWDZ
	
	B11=WID1(I,J,K)**2 * A11(I,J,K)*A11(I,J,K) + WID2(I,J,K)**2 * A21(I,J,K)*A21(I,J,K) + WID3(I,J,K)**2 * A31(I,J,K)*A31(I,J,K)
	B12=WID1(I,J,K)**2 * A11(I,J,K)*A12(I,J,K) + WID2(I,J,K)**2 * A21(I,J,K)*A22(I,J,K) + WID3(I,J,K)**2 * A31(I,J,K)*A32(I,J,K)
	B13=WID1(I,J,K)**2 * A11(I,J,K)*A13(I,J,K) + WID2(I,J,K)**2 * A21(I,J,K)*A23(I,J,K) + WID3(I,J,K)**2 * A31(I,J,K)*A33(I,J,K)
	
!	B21=WID1(I,J,K)**2 * A12(I,J,K)*A11(I,J,K) + WID2(I,J,K)**2 * A22(I,J,K)*A21(I,J,K) + WID3(I,J,K)**2 * A32(I,J,K)*A31(I,J,K)
	B22=WID1(I,J,K)**2 * A12(I,J,K)*A12(I,J,K) + WID2(I,J,K)**2 * A22(I,J,K)*A22(I,J,K) + WID3(I,J,K)**2 * A32(I,J,K)*A32(I,J,K)
	B23=WID1(I,J,K)**2 * A12(I,J,K)*A13(I,J,K) + WID2(I,J,K)**2 * A22(I,J,K)*A23(I,J,K) + WID3(I,J,K)**2 * A32(I,J,K)*A33(I,J,K)
	
!	B31=WID1(I,J,K)**2 * A13(I,J,K)*A11(I,J,K) + WID2(I,J,K)**2 * A23(I,J,K)*A21(I,J,K) + WID3(I,J,K)**2 * A33(I,J,K)*A31(I,J,K)
!	B32=WID1(I,J,K)**2 * A13(I,J,K)*A12(I,J,K) + WID2(I,J,K)**2 * A23(I,J,K)*A22(I,J,K) + WID3(I,J,K)**2 * A33(I,J,K)*A32(I,J,K)
	B33=WID1(I,J,K)**2 * A13(I,J,K)*A13(I,J,K) + WID2(I,J,K)**2 * A23(I,J,K)*A23(I,J,K) + WID3(I,J,K)**2 * A33(I,J,K)*A33(I,J,K)
	
	BBT = B11*B22 + B22*B33 + B33*B11 - B12*B12 - B23*B23 - B13*B13
	DUM = A11(I,J,K)*A11(I,J,K) + A12(I,J,K)*A12(I,J,K) + A13(I,J,K)*A13(I,J,K)	&
		+ A21(I,J,K)*A21(I,J,K) + A22(I,J,K)*A22(I,J,K) + A23(I,J,K)*A23(I,J,K)	&
		+ A31(I,J,K)*A31(I,J,K) + A32(I,J,K)*A32(I,J,K) + A33(I,J,K)*A33(I,J,K)

	PHIG(I,J,K) = DSQRT(BBT/DUM)
	
	ENDDO
	ENDDO
	ENDDO
	
	DO K=KS1,KE1
	DO J=JS1,JE1
	I=0
		S11(I,J,K)=0.5D0* (2.0D0*XIX(I,J,K)*(U(I+1,J,K) - U(I,J,K))		&
								+ETX(I,J,K)*(U(I,J+1,K) - U(I,J-1,K))	&
								+ZTX(I,J,K)*(U(I,J,K+1) - U(I,J,K-1))	)
	
		S12(I,J,K)=0.25D0*(2.0D0*XIY(I,J,K)*(U(I+1,J,K) - U(I,J,K))		&
								+ETY(I,J,K)*(U(I,J+1,K) - U(I,J-1,K))	&
								+ZTY(I,J,K)*(U(I,J,K+1) - U(I,J,K-1))	& 
						  +2.0D0*XIX(I,J,K)*(V(I+1,J,K) - V(I,J,K))		&
								+ETX(I,J,K)*(V(I,J+1,K) - V(I,J-1,K))	&
								+ZTX(I,J,K)*(V(I,J,K+1) - V(I,J,K-1))	)

		S13(I,J,K)=0.25D0*(2.0D0*XIZ(I,J,K)*(U(I+1,J,K) - U(I,J,K))		&
								+ETZ(I,J,K)*(U(I,J+1,K) - U(I,J-1,K))	&
								+ZTZ(I,J,K)*(U(I,J,K+1) - U(I,J,K-1))	&
						  +2.0D0*XIX(I,J,K)*(W(I+1,J,K) - W(I,J,K))		&
								+ETX(I,J,K)*(W(I,J+1,K) - W(I,J-1,K))	&
								+ZTX(I,J,K)*(W(I,J,K+1) - W(I,J,K-1))	)

!		S21(I,J,K)=LSS12(I,J,K)

		S22(I,J,K)=0.5D0* (2.0D0*XIY(I,J,K)*(V(I+1,J,K) - V(I,J,K))		&
								+ETY(I,J,K)*(V(I,J+1,K) - V(I,J-1,K))	&
								+ZTY(I,J,K)*(V(I,J,K+1) - V(I,J,K-1))	)

		S23(I,J,K)=0.25D0*(2.0D0*XIZ(I,J,K)*(V(I+1,J,K) - V(I,J,K))		&
								+ETZ(I,J,K)*(V(I,J+1,K) - V(I,J-1,K))	&
								+ZTZ(I,J,K)*(V(I,J,K+1) - V(I,J,K-1))	&
						  +2.0D0*XIY(I,J,K)*(W(I+1,J,K) - W(I,J,K))		&
								+ETY(I,J,K)*(W(I,J+1,K) - W(I,J-1,K))	&
								+ZTY(I,J,K)*(W(I,J,K+1) - W(I,J,K-1))	)

!		S31(I,J,K)=LSS13(I,J,K)

!		S32(I,J,K)=LSS23(I,J,K)

		S33(I,J,K)=0.5D0* (2.0D0*XIZ(I,J,K)*(W(I+1,J,K) - W(I,J,K))		&
								+ETZ(I,J,K)*(W(I,J+1,K) - W(I,J-1,K))	&
								+ZTZ(I,J,K)*(W(I,J,K+1) - W(I,J,K-1))	)
		
	I=NI
		S11(I,J,K)=0.5D0* (2.0D0*XIX(I,J,K)*(U(I,J,K)   - U(I-1,J,K))	&
								+ETX(I,J,K)*(U(I,J+1,K) - U(I,J-1,K))	&
								+ZTX(I,J,K)*(U(I,J,K+1) - U(I,J,K-1))	)
	
		S12(I,J,K)=0.25D0*(2.0D0*XIY(I,J,K)*(U(I,J,K)   - U(I-1,J,K))	&
								+ETY(I,J,K)*(U(I,J+1,K) - U(I,J-1,K))	&
								+ZTY(I,J,K)*(U(I,J,K+1) - U(I,J,K-1))	&
						  +2.0D0*XIX(I,J,K)*(V(I,J,K)   - V(I-1,J,K))	&
								+ETX(I,J,K)*(V(I,J+1,K) - V(I,J-1,K))	&
								+ZTX(I,J,K)*(V(I,J,K+1) - V(I,J,K-1))	)

		S13(I,J,K)=0.25D0*(2.0D0*XIZ(I,J,K)*(U(I,J,K)   - U(I-1,J,K))	&
								+ETZ(I,J,K)*(U(I,J+1,K) - U(I,J-1,K))	&
								+ZTZ(I,J,K)*(U(I,J,K+1) - U(I,J,K-1))	&
						  +2.0D0*XIX(I,J,K)*(W(I,J,K)   - W(I-1,J,K))	&
								+ETX(I,J,K)*(W(I,J+1,K) - W(I,J-1,K))	&
								+ZTX(I,J,K)*(W(I,J,K+1) - W(I,J,K-1))	)

!		S21(I,J,K)=LSS12(I,J,K)

		S22(I,J,K)=0.5D0* (2.0D0*XIY(I,J,K)*(V(I,J,K)   - V(I-1,J,K))	&
								+ETY(I,J,K)*(V(I,J+1,K) - V(I,J-1,K))	&
								+ZTY(I,J,K)*(V(I,J,K+1) - V(I,J,K-1))	)

		S23(I,J,K)=0.25D0*(2.0D0*XIZ(I,J,K)*(V(I,J,K)   - V(I-1,J,K))	&
								+ETZ(I,J,K)*(V(I,J+1,K) - V(I,J-1,K))	&
								+ZTZ(I,J,K)*(V(I,J,K+1) - V(I,J,K-1))	&
						  +2.0D0*XIY(I,J,K)*(W(I,J,K)   - W(I-1,J,K))	&
								+ETY(I,J,K)*(W(I,J+1,K) - W(I,J-1,K))	&
								+ZTY(I,J,K)*(W(I,J,K+1) - W(I,J,K-1))	)

!		S31(I,J,K)=LSS13(I,J,K)

!		S32(I,J,K)=LSS23(I,J,K)

		S33(I,J,K)=0.5D0* (2.0D0*XIZ(I,J,K)*(W(I,J,K)   - W(I-1,J,K))	&
								+ETZ(I,J,K)*(W(I,J+1,K) - W(I,J-1,K))	&
								+ZTZ(I,J,K)*(W(I,J,K+1) - W(I,J,K-1))	)
								   
	ENDDO
	ENDDO


	!   THE MAGNITUDE OF LARGE-SCALE STRAIN-RATE TENSOR

	CALL TEST_FILTER(U,UA)
	CALL TEST_FILTER(V,VA)
	CALL TEST_FILTER(W,WA)
	
	UIN = 1.D0
    CALL BCU(UA,U_N)
	UIN = 0.D0
    CALL BCU(VA,V_N)
    CALL BCU(WA,W_N)
    
	DO K=KS1,KE1
	DO J=JS1,JE1
	DO I=IS1,IE1
	DUDX=0.5D0*(XIX(I,J,K)*(UA(I+1,J,K)-UA(I-1,J,K))+ETX(I,J,K)*(UA(I,J+1,K)-UA(I,J-1,K))+ZTX(I,J,K)*(UA(I,J,K+1)-UA(I,J,K-1)))
	DVDX=0.5D0*(XIX(I,J,K)*(VA(I+1,J,K)-VA(I-1,J,K))+ETX(I,J,K)*(VA(I,J+1,K)-VA(I,J-1,K))+ZTX(I,J,K)*(VA(I,J,K+1)-VA(I,J,K-1)))
	DWDX=0.5D0*(XIX(I,J,K)*(WA(I+1,J,K)-WA(I-1,J,K))+ETX(I,J,K)*(WA(I,J+1,K)-WA(I,J-1,K))+ZTX(I,J,K)*(WA(I,J,K+1)-WA(I,J,K-1)))
	
	DUDY=0.5D0*(XIY(I,J,K)*(UA(I+1,J,K)-UA(I-1,J,K))+ETY(I,J,K)*(UA(I,J+1,K)-UA(I,J-1,K))+ZTY(I,J,K)*(UA(I,J,K+1)-UA(I,J,K-1)))
	DVDY=0.5D0*(XIY(I,J,K)*(VA(I+1,J,K)-VA(I-1,J,K))+ETY(I,J,K)*(VA(I,J+1,K)-VA(I,J-1,K))+ZTY(I,J,K)*(VA(I,J,K+1)-VA(I,J,K-1)))
	DWDY=0.5D0*(XIY(I,J,K)*(WA(I+1,J,K)-WA(I-1,J,K))+ETY(I,J,K)*(WA(I,J+1,K)-WA(I,J-1,K))+ZTY(I,J,K)*(WA(I,J,K+1)-WA(I,J,K-1)))
	
	DUDZ=0.5D0*(XIZ(I,J,K)*(UA(I+1,J,K)-UA(I-1,J,K))+ETZ(I,J,K)*(UA(I,J+1,K)-UA(I,J-1,K))+ZTZ(I,J,K)*(UA(I,J,K+1)-UA(I,J,K-1)))
	DVDZ=0.5D0*(XIZ(I,J,K)*(VA(I+1,J,K)-VA(I-1,J,K))+ETZ(I,J,K)*(VA(I,J+1,K)-VA(I,J-1,K))+ZTZ(I,J,K)*(VA(I,J,K+1)-VA(I,J,K-1)))
	DWDZ=0.5D0*(XIZ(I,J,K)*(WA(I+1,J,K)-WA(I-1,J,K))+ETZ(I,J,K)*(WA(I,J+1,K)-WA(I,J-1,K))+ZTZ(I,J,K)*(WA(I,J,K+1)-WA(I,J,K-1)))
	
	!	THE LARGE-SCALE STRAIN-RATE TENSOR ,S_ij (STRAIN-RATE TENSOR FOR THE RESOLVED SCALE)
	S11A(I,J,K)=0.5D0*DUDX + 0.5D0*DUDX
	S12A(I,J,K)=0.5D0*DUDY + 0.5D0*DVDX
	S13A(I,J,K)=0.5D0*DUDZ + 0.5D0*DWDX
	
!	S21A(I,J,K)=0.5D0*DVDX + 0.5D0*DUDY
	S22A(I,J,K)=0.5D0*DVDY + 0.5D0*DVDY
	S23A(I,J,K)=0.5D0*DVDZ + 0.5D0*DWDY
	
!	S31A(I,J,K)=0.5D0*DWDX + 0.5D0*DUDZ
!	S32A(I,J,K)=0.5D0*DWDY + 0.5D0*DVDZ
	S33A(I,J,K)=0.5D0*DWDZ + 0.5D0*DWDZ
	
	A11A(I,J,K)=DUDX
	A12A(I,J,K)=DVDX
	A13A(I,J,K)=DWDX
	
	A21A(I,J,K)=DUDY
	A22A(I,J,K)=DVDY
	A23A(I,J,K)=DWDY
	
	A31A(I,J,K)=DUDZ
	A32A(I,J,K)=DVDZ
	A33A(I,J,K)=DWDZ
	
	B11=WID1(I,J,K)**2 * A11A(I,J,K)*A11A(I,J,K) + WID2(I,J,K)**2 * A21A(I,J,K)*A21A(I,J,K) + WID3(I,J,K)**2 * A31A(I,J,K)*A31A(I,J,K)
	B12=WID1(I,J,K)**2 * A11A(I,J,K)*A12A(I,J,K) + WID2(I,J,K)**2 * A21A(I,J,K)*A22A(I,J,K) + WID3(I,J,K)**2 * A31A(I,J,K)*A32A(I,J,K)
	B13=WID1(I,J,K)**2 * A11A(I,J,K)*A13A(I,J,K) + WID2(I,J,K)**2 * A21A(I,J,K)*A23A(I,J,K) + WID3(I,J,K)**2 * A31A(I,J,K)*A33A(I,J,K)
	
!	B21=WID1(I,J,K)**2 * A12A(I,J,K)*A11A(I,J,K) + WID2(I,J,K)**2 * A22A(I,J,K)*A21A(I,J,K) + WID3(I,J,K)**2 * A32A(I,J,K)*A31A(I,J,K)
	B22=WID1(I,J,K)**2 * A12A(I,J,K)*A12A(I,J,K) + WID2(I,J,K)**2 * A22A(I,J,K)*A22A(I,J,K) + WID3(I,J,K)**2 * A32A(I,J,K)*A32A(I,J,K)
	B23=WID1(I,J,K)**2 * A12A(I,J,K)*A13A(I,J,K) + WID2(I,J,K)**2 * A22A(I,J,K)*A23A(I,J,K) + WID3(I,J,K)**2 * A32A(I,J,K)*A33A(I,J,K)
	
!	B31=WID1(I,J,K)**2 * A13A(I,J,K)*A11A(I,J,K) + WID2(I,J,K)**2 * A23A(I,J,K)*A21A(I,J,K) + WID3(I,J,K)**2 * A33A(I,J,K)*A31A(I,J,K)
!	B32=WID1(I,J,K)**2 * A13A(I,J,K)*A12A(I,J,K) + WID2(I,J,K)**2 * A23A(I,J,K)*A22A(I,J,K) + WID3(I,J,K)**2 * A33A(I,J,K)*A32A(I,J,K)
	B33=WID1(I,J,K)**2 * A13A(I,J,K)*A13A(I,J,K) + WID2(I,J,K)**2 * A23A(I,J,K)*A23A(I,J,K) + WID3(I,J,K)**2 * A33A(I,J,K)*A33A(I,J,K)
	
	BBT = 16.D0*( B11*B22 + B22*B33 + B33*B11 - B12*B12 - B23*B23 - B13*B13 )
	
	DUM = A11A(I,J,K)*A11A(I,J,K) + A12A(I,J,K)*A12A(I,J,K) + A13A(I,J,K)*A13A(I,J,K)	&
		+ A21A(I,J,K)*A21A(I,J,K) + A22A(I,J,K)*A22A(I,J,K) + A23A(I,J,K)*A23A(I,J,K)	&
		+ A31A(I,J,K)*A31A(I,J,K) + A32A(I,J,K)*A32A(I,J,K) + A33A(I,J,K)*A33A(I,J,K)
	
	PHIA(I,J,K) = DSQRT(BBT/DUM)
	
	ENDDO
	ENDDO
	ENDDO
	
	!	COMPUTE	11
	DUM_3D(IS:IE,JS:JE,KS:KE)	=A11(IS:IE,JS:JE,KS:KE)*A11(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,A_IJ_A_IJ)
	
	DUM_3D(IS:IE,JS:JE,KS:KE)	=PHIG(IS1:IE1,JS1:JE1,KS1:KE1)*S11(IS:IE,JS:JE,KS:KE)*S11(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,S_IJ_S_IJ)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1)	=(A_IJ_A_IJ(IS1:IE1,JS1:JE1,KS1:KE1)-A11A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	&
								/(S_IJ_S_IJ(IS1:IE1,JS1:JE1,KS1:KE1)		&
								 -PHIA(IS1:IE1,JS1:JE1,KS1:KE1)*S11A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	
	
	!	COMPUTE	22
	DUM_3D(IS:IE,JS:JE,KS:KE)	=A22(IS:IE,JS:JE,KS:KE)*A22(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,A_IJ_A_IJ)
	
	DUM_3D(IS:IE,JS:JE,KS:KE)	=PHIG(IS1:IE1,JS1:JE1,KS1:KE1)*S22(IS:IE,JS:JE,KS:KE)*S22(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,S_IJ_S_IJ)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1) =CV(IS1:IE1,JS1:JE1,KS1:KE1)											&
								+(A_IJ_A_IJ(IS1:IE1,JS1:JE1,KS1:KE1)-A22A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	&
								/(S_IJ_S_IJ(IS1:IE1,JS1:JE1,KS1:KE1)		&
								 -PHIA(IS1:IE1,JS1:JE1,KS1:KE1)*S22A(IS1:IE1,JS1:JE1,KS1:KE1)**2)

	!	COMPUTE	33
	DUM_3D(IS:IE,JS:JE,KS:KE)	=A33(IS:IE,JS:JE,KS:KE)*A33(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,A_IJ_A_IJ)
	
	DUM_3D(IS:IE,JS:JE,KS:KE)	=PHIG(IS1:IE1,JS1:JE1,KS1:KE1)*S33(IS:IE,JS:JE,KS:KE)*S33(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,S_IJ_S_IJ)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1)	=CV(IS1:IE1,JS1:JE1,KS1:KE1)											&
								+(A_IJ_A_IJ(IS1:IE1,JS1:JE1,KS1:KE1)-A33A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	&
								/(S_IJ_S_IJ(IS1:IE1,JS1:JE1,KS1:KE1)		&
								 -PHIA(IS1:IE1,JS1:JE1,KS1:KE1)*S33A(IS1:IE1,JS1:JE1,KS1:KE1)**2)
	
	!	COMPUTE	12
	DUM_3D(IS:IE,JS:JE,KS:KE)	=A12(IS:IE,JS:JE,KS:KE)*A12(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,A_IJ_A_IJ)
	
	DUM_3D(IS:IE,JS:JE,KS:KE)	=PHIG(IS1:IE1,JS1:JE1,KS1:KE1)*S12(IS:IE,JS:JE,KS:KE)*S12(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,S_IJ_S_IJ)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1)	=CV(IS1:IE1,JS1:JE1,KS1:KE1)												&
								+2.D0*(A_IJ_A_IJ(IS1:IE1,JS1:JE1,KS1:KE1)-A12A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	&
								/(S_IJ_S_IJ(IS1:IE1,JS1:JE1,KS1:KE1)			&
								 -PHIA(IS1:IE1,JS1:JE1,KS1:KE1)*S12A(IS1:IE1,JS1:JE1,KS1:KE1)**2)
	
	!	COMPUTE	13
	DUM_3D(IS:IE,JS:JE,KS:KE)	=A13(IS:IE,JS:JE,KS:KE)*A13(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,A_IJ_A_IJ)
	
	DUM_3D(IS:IE,JS:JE,KS:KE)	=PHIG(IS1:IE1,JS1:JE1,KS1:KE1)*S13(IS:IE,JS:JE,KS:KE)*S13(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,S_IJ_S_IJ)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1)	=CV(IS1:IE1,JS1:JE1,KS1:KE1)												&
								+2.D0*(A_IJ_A_IJ(IS1:IE1,JS1:JE1,KS1:KE1)-A13A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	&
								/(S_IJ_S_IJ(IS1:IE1,JS1:JE1,KS1:KE1)			&
								 -PHIA(IS1:IE1,JS1:JE1,KS1:KE1)*S13A(IS1:IE1,JS1:JE1,KS1:KE1)**2)
	
	!	COMPUTE	23
	DUM_3D(IS:IE,JS:JE,KS:KE)	=A23(IS:IE,JS:JE,KS:KE)*A23(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,A_IJ_A_IJ)
	
	DUM_3D(IS:IE,JS:JE,KS:KE)	=PHIG(IS1:IE1,JS1:JE1,KS1:KE1)*S23(IS:IE,JS:JE,KS:KE)*S23(IS:IE,JS:JE,KS:KE)
	
	CALL TEST_FILTER(DUM_3D,S_IJ_S_IJ)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1)	=CV(IS1:IE1,JS1:JE1,KS1:KE1)												&
								+2.D0*(A_IJ_A_IJ(IS1:IE1,JS1:JE1,KS1:KE1)-A23A(IS1:IE1,JS1:JE1,KS1:KE1)**2)	&
								/(S_IJ_S_IJ(IS1:IE1,JS1:JE1,KS1:KE1)			&
								 -PHIA(IS1:IE1,JS1:JE1,KS1:KE1)*S23A(IS1:IE1,JS1:JE1,KS1:KE1)**2)
	
	CV(IS1:IE1,JS1:JE1,KS1:KE1) = -1.D0/(2.D0*RE)*CV(IS1:IE1,JS1:JE1,KS1:KE1)
	IF(NITER_TIME.LT.100) CV(IS1:IE1,JS1:JE1,KS1:KE1) = 0.025D0

!	AVERAGED VALUE
	CV_AVG	= 0.D0
	INC		= 0.D0
	
	DO K = KS1,KE1
	DO J = JS1,JE1
	DO I = IS1,IE1
!		IF(PHIG(I,J,K).EQ.0.D0) CV(I,J,K)=0.D0
		CV_AVG = CV_AVG + CV(I,J,K)
		INC = INC + 1.D0
	ENDDO
	ENDDO
	ENDDO					 
	
	CALL MPI_ALLREDUCE(CV_AVG,DUM_A,1,MPI_DOUBLE_PRECISION, MPI_SUM,NMCW,ERR)
	CALL MPI_ALLREDUCE(INC,DUM_B,1,MPI_DOUBLE_PRECISION, MPI_SUM,NMCW,ERR)
	
	CV_AVG = DUM_A / DUM_B
	
	IF(RANK.EQ.0) THEN
		OPEN(UNIT=12,FILE='CV.PLT',STATUS='OLD',ACCESS='APPEND')
		WRITE(12,*) RTIME,CV_AVG
		CLOSE(12)
	ENDIF
	
	EDDY_VISCOS(IS1:IE1,JS1:JE1,KS1:KE1) = CV(IS1:IE1,JS1:JE1,KS1:KE1)*PHIG(IS1:IE1,JS1:JE1,KS1:KE1)
	
	! DIVERGENCE OF THE SUBGRID-SCALE STRESS TENSOR T_IJ
	
	DO K = KS1,KE1
	DO J = JS1,JE1
	DO I = IS1,IE1
	SGS_X(I,J,K) = 0.5D0*(	&
		+ XIX(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S11(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S11(I-1,J,K))	&
		+ ETX(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S11(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S11(I,J-1,K))	&
		+ ZTX(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S11(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S11(I,J,K-1))	&
	
		+ XIY(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S12(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S12(I-1,J,K))	&
		+ ETY(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S12(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S12(I,J-1,K))	&
		+ ZTY(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S12(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S12(I,J,K-1))	&
						
		+ XIZ(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S13(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S13(I-1,J,K))	&
		+ ETZ(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S13(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S13(I,J-1,K))	&
		+ ZTZ(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S13(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S13(I,J,K-1))	)
	
	SGS_Y(I,J,K) = 0.5D0*(	&
		+ XIX(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S12(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S12(I-1,J,K))	&
		+ ETX(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S12(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S12(I,J-1,K))	&
		+ ZTX(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S12(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S12(I,J,K-1))	&
	
		+ XIY(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S22(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S22(I-1,J,K))	&
		+ ETY(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S22(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S22(I,J-1,K))	&
		+ ZTY(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S22(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S22(I,J,K-1))	&
						
		+ XIZ(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S23(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S23(I-1,J,K))	&
		+ ETZ(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S23(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S23(I,J-1,K))	&
		+ ZTZ(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S23(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S23(I,J,K-1))	)
		          
	SGS_Z(I,J,K) = 0.5D0*(	&
		+ XIX(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S13(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S13(I-1,J,K))	&
		+ ETX(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S13(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S13(I,J-1,K))	&
		+ ZTX(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S13(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S13(I,J,K-1))	&

		+ XIY(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S23(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S23(I-1,J,K))	&
		+ ETY(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S23(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S23(I,J-1,K))	&
		+ ZTY(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S23(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S23(I,J,K-1))	&
					
		+ XIZ(I,J,K)*(-2.D0*EDDY_VISCOS(I+1,J,K)*S33(I+1,J,K) +2.D0*EDDY_VISCOS(I-1,J,K)*S33(I-1,J,K))	&
		+ ETZ(I,J,K)*(-2.D0*EDDY_VISCOS(I,J+1,K)*S33(I,J+1,K) +2.D0*EDDY_VISCOS(I,J-1,K)*S33(I,J-1,K))	&
		+ ZTZ(I,J,K)*(-2.D0*EDDY_VISCOS(I,J,K+1)*S33(I,J,K+1) +2.D0*EDDY_VISCOS(I,J,K-1)*S33(I,J,K-1))	)
	ENDDO
	ENDDO
	ENDDO
	
	END SUBROUTINE STRESS_TENSOR_DY